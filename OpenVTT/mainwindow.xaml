<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="OpenVTT.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:OpenVTT"
        xmlns:ctrls="clr-namespace:OpenVTT.Controls"
        Title="OpenVTT" Height="780" Width="1250" MinHeight="650" MinWidth="1040">
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Top Toolbar (global) -->
    <ToolBarTray Grid.Row="0">
      <ToolBar>
        <Button Click="New_Click">New Script</Button>
        <Button Click="Open_Click">Open Script...</Button>
        <Button Click="SaveAs_Click">Save Script As...</Button>
        <Separator/>
        <Button Click="StartTeleprompter_Click">Start Teleprompter (F5)</Button>
        <ToggleButton x:Name="MirrorToggle" Content="Mirror" Margin="4,0"/>
        <Separator/>
        <TextBlock VerticalAlignment="Center" Margin="8,0">Editor Font</TextBlock>
        <Slider x:Name="FontSlider" Minimum="12" Maximum="42" Width="150" ValueChanged="FontSlider_ValueChanged"/>
        <Separator/>
        <TextBox x:Name="SearchBox" Width="220" KeyDown="SearchBox_KeyDown" ToolTip="Search in Script (Enter)"/>
        <Button Click="FindNext_Click">Find Next</Button>
      </ToolBar>
    </ToolBarTray>

    <!-- Content Tabs -->
    <TabControl Grid.Row="1" x:Name="MainTabs">
      <!-- Script & Scenes Tab -->
      <TabItem Header="ðŸ“œ Script & Scenes">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>

          <!-- Scenes Panel -->
          <DockPanel Grid.Column="0" Background="#EADDB8" Margin="4" LastChildFill="True">
            <Border Background="#D7C89C" Padding="10" DockPanel.Dock="Top">
              <TextBlock FontWeight="Bold">Scenes</TextBlock>
            </Border>
            <ListBox x:Name="ScenesList" Margin="8" SelectionChanged="ScenesList_SelectionChanged">
              <ListBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Title}" TextTrimming="CharacterEllipsis"/>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </DockPanel>

          <!-- Script Editor -->
          <Grid Grid.Column="1" Margin="8">
            <Border BorderBrush="#C8B785" BorderThickness="1" CornerRadius="8" Padding="8" Background="#FFFBEA">
              <ScrollViewer x:Name="EditorScroll">
                <TextBox x:Name="ScriptBox"
                         AcceptsReturn="True" AcceptsTab="True" VerticalScrollBarVisibility="Visible" HorizontalScrollBarVisibility="Auto"
                         FontFamily="Consolas" FontSize="16" TextChanged="ScriptBox_TextChanged"/>
              </ScrollViewer>
            </Border>
          </Grid>
        </Grid>
      </TabItem>

      <!-- 2D Virtual Tabletop -->
      <TabItem Header="ðŸ—ºï¸ 2D VTT">
        <ctrls:Tabletop2DControl/>
      </TabItem>

      <!-- 3D Virtual Tabletop -->
      <TabItem Header="ðŸ§± 3D VTT">
        <ctrls:Tabletop3DControl/>
      </TabItem>

      <!-- Map Editor -->
      <TabItem Header="ðŸ› ï¸ Map Editor">
        <ctrls:MapEditorControl/>
      </TabItem>
    </TabControl>

    <!-- Status Bar -->
    <StatusBar Grid.Row="2">
      <StatusBarItem>
        <TextBlock x:Name="StatusText" Text="Ready"/>
      </StatusBarItem>
      <StatusBarItem HorizontalAlignment="Right">
        <TextBlock Text="Tips: # or ## starts a scene â€¢ F5 Teleprompter â€¢ Ctrl+S Save"/>
      </StatusBarItem>
    </StatusBar>
  </Grid>
</Window>
